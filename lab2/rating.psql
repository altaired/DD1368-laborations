-- use to change rating

\set user 1
\set movie 2
\set rate 4

WITH thismovie AS(
  SELECT *
  FROM user_watch
  WHERE uconst = :user AND tconst = :movie
)

UPDATE user_watch
SET rating = :rate
WHERE (SELECT COUNT(*) FROM thismovie) > 0
  AND (SELECT COUNT(*) FROM title_basics WHERE title_type = 'MOVIE' OR title_type = 'TV-EPISODE')>0 
  AND tconst = :movie
